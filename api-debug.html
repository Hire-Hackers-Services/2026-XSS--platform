<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>APIè°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; }
        .test-btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-btn:hover { background: #005a9e; }
        .result {
            background: #252526;
            border-left: 3px solid #4ec9b0;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left-color: #4ec9b0; }
        .error { border-left-color: #f48771; color: #f48771; }
        .info { border-left-color: #569cd6; }
    </style>
</head>
<body>
    <h1>ğŸ” APIè°ƒè¯•å·¥å…·</h1>
    
    <div>
        <h2>Step 1: æµ‹è¯•æœ€ç®€å•çš„API</h2>
        <button class="test-btn" onclick="testSimple()">æµ‹è¯• /api/simple-test.php</button>
        <div class="result" id="result1">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>
    
    <div>
        <h2>Step 2: æµ‹è¯•å¸¦é…ç½®çš„API</h2>
        <button class="test-btn" onclick="testWithConfig()">æµ‹è¯• /api/test.php</button>
        <div class="result" id="result2">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>
    
    <div>
        <h2>Step 3: æµ‹è¯•å®Œæ•´çš„collect API</h2>
        <button class="test-btn" onclick="testCollect()">æµ‹è¯• /api/collect.php</button>
        <div class="result" id="result3">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>
    
    <div>
        <h2>Step 4: ç›´æ¥æµè§ˆå™¨è®¿é—®æµ‹è¯•</h2>
        <p>è¯·ç›´æ¥åœ¨æµè§ˆå™¨æ‰“å¼€ä»¥ä¸‹é“¾æ¥æŸ¥çœ‹åŸå§‹å“åº”ï¼š</p>
        <ul>
            <li><a href="/api/simple-test.php" target="_blank">/api/simple-test.php</a></li>
            <li><a href="/api/test.php" target="_blank">/api/test.php</a></li>
            <li><a href="/api/collect.php?test=1" target="_blank">/api/collect.php?test=1</a></li>
        </ul>
    </div>

    <script>
        async function testSimple() {
            const div = document.getElementById('result1');
            div.className = 'result info';
            div.textContent = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/simple-test.php');
                const status = response.status;
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                div.textContent = `HTTPçŠ¶æ€: ${status}
Content-Type: ${contentType}

åŸå§‹å“åº”:
${text}`;
                
                if (contentType && contentType.includes('application/json')) {
                    try {
                        const json = JSON.parse(text);
                        div.textContent += '\n\nJSONè§£ææˆåŠŸ:\n' + JSON.stringify(json, null, 2);
                        div.className = 'result success';
                    } catch (e) {
                        div.textContent += '\n\n[é”™è¯¯] JSONè§£æå¤±è´¥: ' + e.message;
                        div.className = 'result error';
                    }
                } else {
                    div.textContent += '\n\n[è­¦å‘Š] è¿”å›çš„ä¸æ˜¯JSONæ ¼å¼';
                    div.className = 'result error';
                }
            } catch (error) {
                div.textContent = '[é”™è¯¯] è¯·æ±‚å¤±è´¥:\n' + error.message;
                div.className = 'result error';
            }
        }
        
        async function testWithConfig() {
            const div = document.getElementById('result2');
            div.className = 'result info';
            div.textContent = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/test.php');
                const status = response.status;
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                div.textContent = `HTTPçŠ¶æ€: ${status}
Content-Type: ${contentType}

åŸå§‹å“åº”:
${text}`;
                
                if (contentType && contentType.includes('application/json')) {
                    try {
                        const json = JSON.parse(text);
                        div.textContent += '\n\nJSONè§£ææˆåŠŸ:\n' + JSON.stringify(json, null, 2);
                        div.className = 'result success';
                    } catch (e) {
                        div.textContent += '\n\n[é”™è¯¯] JSONè§£æå¤±è´¥: ' + e.message;
                        div.className = 'result error';
                    }
                } else {
                    div.textContent += '\n\n[è­¦å‘Š] è¿”å›çš„ä¸æ˜¯JSONæ ¼å¼';
                    div.className = 'result error';
                }
            } catch (error) {
                div.textContent = '[é”™è¯¯] è¯·æ±‚å¤±è´¥:\n' + error.message;
                div.className = 'result error';
            }
        }
        
        async function testCollect() {
            const div = document.getElementById('result3');
            div.className = 'result info';
            div.textContent = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/collect.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'debug_test',
                        message: 'APIè°ƒè¯•æµ‹è¯•',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const status = response.status;
                const contentType = response.headers.get('content-type');
                const text = await response.text();
                
                div.textContent = `HTTPçŠ¶æ€: ${status}
Content-Type: ${contentType}

åŸå§‹å“åº”:
${text.substring(0, 2000)}`;
                
                if (contentType && contentType.includes('application/json')) {
                    try {
                        const json = JSON.parse(text);
                        div.textContent += '\n\nJSONè§£ææˆåŠŸ:\n' + JSON.stringify(json, null, 2);
                        div.className = 'result success';
                    } catch (e) {
                        div.textContent += '\n\n[é”™è¯¯] JSONè§£æå¤±è´¥: ' + e.message;
                        div.className = 'result error';
                    }
                } else {
                    div.textContent += '\n\n[è­¦å‘Š] è¿”å›çš„ä¸æ˜¯JSONæ ¼å¼ï¼Œå¯èƒ½æ˜¯PHPé”™è¯¯é¡µé¢';
                    div.className = 'result error';
                }
            } catch (error) {
                div.textContent = '[é”™è¯¯] è¯·æ±‚å¤±è´¥:\n' + error.message;
                div.className = 'result error';
            }
        }
    </script>
</body>
</html>
